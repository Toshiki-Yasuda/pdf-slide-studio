<!DOCTYPE html>


<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>PDF Slide Studio - PDFã‚’è¤‡æ•°å½¢å¼ã«å¤‰æ›</title>
  <meta name="description" content="PDFã‚¹ãƒ©ã‚¤ãƒ‰ã‚’PNGã€PowerPointã€GIFã€é•·ç”»åƒã«å¤‰æ›ã€‚å®Œå…¨ã«ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å‡¦ç†ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸è¦ã€‚">

  <!-- OGP / SNSå…±æœ‰ -->

  <meta property="og:title" content="PDF Slide Studio">
  <meta property="og:description" content="PDFã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è¤‡æ•°å½¢å¼ã«å¤‰æ›ã€‚å®Œå…¨ã«ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å‡¦ç†ã€‚">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://toshiki-yasuda.github.io/pdf-slide-studio/">
  <meta name="twitter:card" content="summary">

  <!-- Favicon -->

  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“„</text></svg>">

  <!-- Tailwind CSS -->

  <script src="https://cdn.tailwindcss.com"></script>

  <!-- External Libraries -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>

  <!-- Lucide Icons -->

  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

  <style>
    * {
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }
    
    @keyframes aurora-1 {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(20px, -20px) scale(1.1); }
    }
    @keyframes aurora-2 {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(-20px, 10px) scale(1.2); }
    }
    .animate-aurora-1 { animation: aurora-1 10s infinite ease-in-out; }
    .animate-aurora-2 { animation: aurora-2 12s infinite ease-in-out; }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .animate-spin { animation: spin 1s linear infinite; }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    
    /* ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚¿ãƒƒãƒãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ */
    @media (hover: none) and (pointer: coarse) {
      .touch-feedback:active {
        transform: scale(0.98);
        opacity: 0.9;
      }
    }
    
    /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.05);
      border-radius: 3px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.2);
      border-radius: 3px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: rgba(255,255,255,0.3);
    }
    
    /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒªãƒ³ã‚° */
    .progress-ring {
      transform: rotate(-90deg);
    }
    .progress-ring__circle {
      transition: stroke-dasharray 0.3s ease;
    }
    
    /* ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–çŠ¶æ…‹ */
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>

</head>
<body class="bg-slate-950 text-slate-200 min-h-screen">

  <!-- Aurora Background -->

  <div class="fixed inset-0 pointer-events-none overflow-hidden" aria-hidden="true">
    <div class="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-indigo-600/20 rounded-full blur-[100px] animate-aurora-1"></div>
    <div class="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-cyan-600/20 rounded-full blur-[100px] animate-aurora-2"></div>
  </div>

  <!-- Main App Container -->

  <div id="app" class="relative z-10 min-h-screen p-4 md:p-6 flex flex-col items-center justify-center">
    <div class="w-full max-w-7xl space-y-6 md:space-y-8">

```
  <!-- Header -->
  <header class="text-center space-y-4 md:space-y-6 pt-2 md:pt-4">
    <div class="inline-flex items-center gap-2 px-3 md:px-4 py-1.5 rounded-full bg-white/5 border border-white/10 backdrop-blur-md">
      <i data-lucide="sparkles" class="w-3.5 h-3.5 text-cyan-300" aria-hidden="true"></i>
      <span class="text-[10px] md:text-[11px] uppercase tracking-[0.15em] md:tracking-[0.2em] font-bold text-cyan-300/90">PDF Slide Studio</span>
    </div>
    
    <div id="header-content">
      <h1 class="text-2xl md:text-4xl lg:text-5xl font-extrabold tracking-tight text-white leading-tight px-2">
        PDFã‚’è¤‡æ•°å½¢å¼ã«å¤‰æ›
      </h1>
      <p class="text-slate-400 text-sm md:text-lg max-w-2xl mx-auto font-light px-4 mt-4">
        ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’PNGãƒ»PPTXãƒ»GIFãƒ»é•·ç”»åƒã«å¤‰æ›ã€‚å®Œå…¨ã«ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å‡¦ç†ã€‚
      </p>
    </div>
  </header>

  <!-- Main Content Area -->
  <main id="main-content" role="main">
    
    <!-- Upload Area (Default State) -->
    <div id="upload-area" class="bg-white/5 backdrop-blur-2xl rounded-2xl md:rounded-[2.5rem] shadow-[0_8px_32px_0_rgba(0,0,0,0.36)] border border-white/10 overflow-hidden">
      <input 
        type="file" 
        id="file-input" 
        class="hidden" 
        accept="application/pdf,.pdf"
        aria-label="PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ"
      >
      
      <button 
        type="button" 
        id="upload-button"
        class="relative w-full p-12 md:p-24 text-center cursor-pointer group transition-all duration-300 hover:bg-white/5 active:bg-white/10 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 touch-feedback"
        aria-describedby="upload-description"
      >
        <div class="flex flex-col items-center gap-6 md:gap-8">
          <div id="upload-icon" class="w-20 h-20 md:w-24 md:h-24 rounded-2xl md:rounded-3xl flex items-center justify-center bg-slate-800/50 text-cyan-300 group-hover:bg-slate-800/80 transition-all duration-300">
            <i data-lucide="file-text" class="w-8 h-8 md:w-10 md:h-10" aria-hidden="true"></i>
          </div>
          <div class="space-y-2 md:space-y-3">
            <p class="text-xl md:text-2xl font-bold text-slate-200 group-hover:text-white transition-colors">
              PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
            </p>
            <p id="upload-description" class="text-xs md:text-sm text-slate-500">
              ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠ ã¾ãŸã¯ ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
            </p>
          </div>
          
          <!-- æ˜ç¤ºçš„ãªé¸æŠãƒœã‚¿ãƒ³ -->
          <div class="mt-2 px-6 py-3 bg-cyan-600 hover:bg-cyan-700 active:bg-cyan-800 text-white rounded-xl font-medium text-sm md:text-base transition-all shadow-lg shadow-cyan-600/30 flex items-center gap-2">
            <i data-lucide="folder-open" class="w-5 h-5" aria-hidden="true"></i>
            ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
          </div>
          
          <div id="init-status" class="inline-flex items-center gap-2 px-4 py-2 bg-black/20 border border-white/5 text-slate-400 text-xs font-medium rounded-full mt-4 backdrop-blur-sm">
            <i data-lucide="loader-2" class="w-3 h-3 animate-spin text-cyan-400" aria-hidden="true"></i>
            <span>åˆæœŸåŒ–ä¸­...</span>
          </div>
        </div>
      </button>
    </div>

    <!-- Processing View (Hidden by default) -->
    <div id="processing-area" class="hidden bg-white/5 backdrop-blur-2xl rounded-2xl md:rounded-[2.5rem] border border-white/10 overflow-hidden p-12 md:p-24 flex-col items-center justify-center min-h-[400px] md:min-h-[500px]" role="status" aria-live="polite">
      <div class="relative w-36 h-36 md:w-48 md:h-48 mb-8 md:mb-10">
        <svg class="w-full h-full progress-ring" viewBox="0 0 100 100" aria-hidden="true">
          <circle class="text-slate-800/50 stroke-current" stroke-width="2" cx="50" cy="50" r="46" fill="transparent"></circle>
          <circle 
            id="progress-circle"
            class="text-cyan-400 stroke-current progress-ring__circle" 
            stroke-width="2" 
            stroke-linecap="round" 
            cx="50" cy="50" r="46" 
            fill="transparent"
            stroke-dasharray="0 289.02"
            style="filter: drop-shadow(0 0 8px rgba(34,211,238,0.8));"
          ></circle>
        </svg>
        <div class="absolute inset-0 flex items-center justify-center">
          <span id="progress-percent" class="text-3xl md:text-4xl font-bold text-white">0%</span>
        </div>
      </div>
      <h3 id="progress-message" class="text-lg md:text-xl font-bold text-white mb-2 animate-pulse text-center px-4">
        æº–å‚™ä¸­...
      </h3>
      <button id="cancel-button" class="mt-6 px-8 py-3 text-sm font-bold text-slate-500 hover:text-white active:text-white rounded-full hover:bg-white/10 active:bg-white/20 transition-all touch-feedback">
        ã‚­ãƒ£ãƒ³ã‚»ãƒ«
      </button>
    </div>

    <!-- Editor View (Hidden by default) -->
    <div id="editor-area" class="hidden space-y-4 md:space-y-6">
      
      <!-- Controls -->
      <div class="flex flex-col md:flex-row gap-3 md:gap-4 items-stretch md:items-center justify-between bg-white/5 backdrop-blur-xl border border-white/10 rounded-xl md:rounded-2xl p-3 md:p-4">
        <div class="flex gap-4 items-center justify-center md:justify-start">
          <span id="file-name" class="text-sm text-cyan-300 font-medium truncate max-w-[200px]"></span>
          <span id="slide-count" class="text-xs text-slate-500"></span>
        </div>
        <div class="flex gap-2 flex-wrap justify-center md:justify-end">
          <button id="download-zip-btn" class="flex-1 md:flex-none px-3 md:px-4 py-2.5 bg-cyan-600 hover:bg-cyan-700 active:bg-cyan-800 disabled:bg-cyan-600 text-white rounded-lg text-xs md:text-sm font-medium transition-all flex items-center justify-center gap-1.5 touch-feedback" title="PNGç”»åƒã‚’ZIPå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰">
            <i data-lucide="file-archive" class="w-4 h-4" aria-hidden="true"></i>
            <span class="hidden sm:inline">ç”»åƒZIP</span>
            <span class="sm:hidden">ZIP</span>
          </button>
          <button id="download-pptx-btn" class="flex-1 md:flex-none px-3 md:px-4 py-2.5 bg-orange-600 hover:bg-orange-700 active:bg-orange-800 disabled:bg-orange-600 text-white rounded-lg text-xs md:text-sm font-medium transition-all flex items-center justify-center gap-1.5 touch-feedback" title="PowerPointå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰">
            <i data-lucide="presentation" class="w-4 h-4" aria-hidden="true"></i>
            <span class="hidden sm:inline">PPTX</span>
            <span class="sm:hidden">PPT</span>
          </button>
          <button id="download-gif-btn" class="flex-1 md:flex-none px-3 md:px-4 py-2.5 bg-purple-600 hover:bg-purple-700 active:bg-purple-800 disabled:bg-purple-600 text-white rounded-lg text-xs md:text-sm font-medium transition-all flex items-center justify-center gap-1.5 touch-feedback" title="ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³GIFå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰">
            <i data-lucide="film" class="w-4 h-4" aria-hidden="true"></i>
            <span>GIF</span>
          </button>
          <button id="download-long-btn" class="flex-1 md:flex-none px-3 md:px-4 py-2.5 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:bg-blue-600 text-white rounded-lg text-xs md:text-sm font-medium transition-all flex items-center justify-center gap-1.5 touch-feedback" title="ç¸¦é•·1æšç”»åƒã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰">
            <i data-lucide="scroll-text" class="w-4 h-4" aria-hidden="true"></i>
            <span class="hidden sm:inline">é•·ç”»åƒ</span>
            <span class="sm:hidden">é•·</span>
          </button>
          <button id="reset-btn" class="px-3 md:px-4 py-2.5 bg-slate-700 hover:bg-slate-600 active:bg-slate-500 text-white rounded-lg text-xs md:text-sm font-medium transition-all flex items-center justify-center gap-1.5 touch-feedback" title="æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ">
            <i data-lucide="refresh-cw" class="w-4 h-4" aria-hidden="true"></i>
          </button>
        </div>
      </div>

      <!-- Slide Grid -->
      <div class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-xl md:rounded-2xl p-3 md:p-4">
        <h3 class="text-sm font-bold text-white mb-4 flex items-center gap-2">
          <i data-lucide="layout-grid" class="w-4 h-4" aria-hidden="true"></i>
          ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        </h3>
        <div id="slide-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 md:gap-4 max-h-[60vh] overflow-y-auto custom-scrollbar" role="list">
          <!-- Slides will be inserted here -->
        </div>
      </div>
    </div>

    <!-- Error View (Hidden by default) -->
    <div id="error-area" class="hidden bg-white/5 backdrop-blur-2xl rounded-2xl md:rounded-[2.5rem] border border-white/10 p-12 md:p-20 text-center space-y-6" role="alert">
      <div class="w-16 h-16 md:w-20 md:h-20 bg-red-500/20 rounded-full flex items-center justify-center mx-auto">
        <i data-lucide="x" class="w-8 h-8 md:w-10 md:h-10 text-red-500" aria-hidden="true"></i>
      </div>
      <h3 class="text-lg md:text-xl font-bold text-slate-200">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h3>
      <p id="error-message" class="text-slate-500 text-sm md:text-base"></p>
      <button id="retry-btn" class="px-8 py-3 bg-white/10 text-white rounded-xl hover:bg-white/20 active:bg-white/30 transition-all font-medium touch-feedback">
        ãƒªãƒˆãƒ©ã‚¤
      </button>
    </div>

  </main>

  <!-- Footer -->
  <footer class="text-center text-xs text-slate-600 py-4">
    <a href="https://github.com/Toshiki-Yasuda/pdf-slide-studio" target="_blank" rel="noopener noreferrer" class="hover:text-slate-400 transition-colors">
      PDF Slide Studio
    </a>
    â€¢ Mobile Optimized â€¢ No Upload Required
  </footer>
  
</div>
```

  </div>

  <!-- Modal for Slide Preview -->

  <div id="slide-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/80 backdrop-blur-sm p-4" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="relative max-w-4xl w-full max-h-[90vh] bg-slate-900 rounded-2xl overflow-hidden">
      <button id="close-modal" class="absolute top-4 right-4 z-10 w-10 h-10 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition-all" aria-label="é–‰ã˜ã‚‹">
        <i data-lucide="x" class="w-5 h-5" aria-hidden="true"></i>
      </button>
      <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
      <button id="prev-slide" class="absolute left-4 top-1/2 -translate-y-1/2 z-10 w-10 h-10 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition-all" aria-label="å‰ã®ã‚¹ãƒ©ã‚¤ãƒ‰">
        <i data-lucide="chevron-left" class="w-5 h-5" aria-hidden="true"></i>
      </button>
      <button id="next-slide" class="absolute right-4 top-1/2 -translate-y-1/2 z-10 w-10 h-10 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition-all" aria-label="æ¬¡ã®ã‚¹ãƒ©ã‚¤ãƒ‰">
        <i data-lucide="chevron-right" class="w-5 h-5" aria-hidden="true"></i>
      </button>
      <div class="p-4 overflow-auto max-h-[90vh]">
        <h2 id="modal-title" class="sr-only">ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
        <img id="modal-image" src="" alt="ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" class="w-full h-auto rounded-lg">
        <p id="modal-caption" class="text-center text-slate-400 text-sm mt-4"></p>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->

  <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 hidden px-6 py-3 bg-slate-800 border border-slate-700 text-white rounded-xl shadow-xl transition-all transform" role="status" aria-live="polite">
    <div class="flex items-center gap-3">
      <i id="toast-icon" data-lucide="check-circle" class="w-5 h-5 text-green-400" aria-hidden="true"></i>
      <span id="toast-message">å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ</span>
    </div>
  </div>

  <script>
    // Initialize PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    // App State
    const state = {
      file: null,
      images: [],
      zipBlob: null,
      status: 'idle',
      progress: { current: 0, total: 0, message: '' },
      cancelRequested: false,
      currentModalSlide: 0,
      isExporting: false
    };

    // DOM Elements
    const elements = {
      fileInput: document.getElementById('file-input'),
      uploadArea: document.getElementById('upload-area'),
      uploadButton: document.getElementById('upload-button'),
      processingArea: document.getElementById('processing-area'),
      editorArea: document.getElementById('editor-area'),
      errorArea: document.getElementById('error-area'),
      initStatus: document.getElementById('init-status'),
      headerContent: document.getElementById('header-content'),
      progressCircle: document.getElementById('progress-circle'),
      progressPercent: document.getElementById('progress-percent'),
      progressMessage: document.getElementById('progress-message'),
      cancelButton: document.getElementById('cancel-button'),
      fileName: document.getElementById('file-name'),
      slideCount: document.getElementById('slide-count'),
      slideGrid: document.getElementById('slide-grid'),
      downloadZipBtn: document.getElementById('download-zip-btn'),
      downloadPptxBtn: document.getElementById('download-pptx-btn'),
      downloadGifBtn: document.getElementById('download-gif-btn'),
      downloadLongBtn: document.getElementById('download-long-btn'),
      resetBtn: document.getElementById('reset-btn'),
      retryBtn: document.getElementById('retry-btn'),
      errorMessage: document.getElementById('error-message'),
      slideModal: document.getElementById('slide-modal'),
      closeModal: document.getElementById('close-modal'),
      prevSlide: document.getElementById('prev-slide'),
      nextSlide: document.getElementById('next-slide'),
      modalImage: document.getElementById('modal-image'),
      modalCaption: document.getElementById('modal-caption'),
      toast: document.getElementById('toast'),
      toastIcon: document.getElementById('toast-icon'),
      toastMessage: document.getElementById('toast-message')
    };

    // Initialize Lucide icons
    lucide.createIcons();

    // Hide init status after libraries load
    setTimeout(() => {
      elements.initStatus.classList.add('hidden');
    }, 1500);

    // ============================================
    // Event Listeners
    // ============================================

    elements.uploadButton.addEventListener('click', (e) => {
      e.preventDefault();
      elements.fileInput.click();
    });

    elements.uploadButton.addEventListener('touchend', (e) => {
      e.preventDefault();
      elements.fileInput.click();
    });

    elements.fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file && file.type === 'application/pdf') {
        processFile(file);
      } else if (file) {
        showError('PDFãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚');
      }
    });

    // Drag and Drop
    elements.uploadButton.addEventListener('dragover', (e) => {
      e.preventDefault();
      elements.uploadButton.classList.add('bg-indigo-500/10');
    });

    elements.uploadButton.addEventListener('dragleave', (e) => {
      e.preventDefault();
      elements.uploadButton.classList.remove('bg-indigo-500/10');
    });

    elements.uploadButton.addEventListener('drop', (e) => {
      e.preventDefault();
      elements.uploadButton.classList.remove('bg-indigo-500/10');
      const file = e.dataTransfer.files[0];
      if (file && file.type === 'application/pdf') {
        processFile(file);
      } else if (file) {
        showError('PDFãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚');
      }
    });

    elements.cancelButton.addEventListener('click', () => {
      state.cancelRequested = true;
      updateProgress(0, 0, 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«ä¸­...');
    });

    elements.resetBtn.addEventListener('click', reset);
    elements.retryBtn.addEventListener('click', reset);

    elements.downloadZipBtn.addEventListener('click', downloadZip);
    elements.downloadPptxBtn.addEventListener('click', downloadPptx);
    elements.downloadGifBtn.addEventListener('click', downloadGif);
    elements.downloadLongBtn.addEventListener('click', downloadLongImage);

    // Modal controls
    elements.closeModal.addEventListener('click', closeModal);
    elements.prevSlide.addEventListener('click', () => navigateSlide(-1));
    elements.nextSlide.addEventListener('click', () => navigateSlide(1));

    elements.slideModal.addEventListener('click', (e) => {
      if (e.target === elements.slideModal) closeModal();
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (!elements.slideModal.classList.contains('hidden')) {
        if (e.key === 'Escape') closeModal();
        if (e.key === 'ArrowLeft') navigateSlide(-1);
        if (e.key === 'ArrowRight') navigateSlide(1);
      }
    });

    // ============================================
    // Process PDF File
    // ============================================
    async function processFile(file) {
      state.file = file;
      state.images = [];
      state.zipBlob = null;
      state.cancelRequested = false;
      
      showProcessing();
      updateProgress(0, 0, 'PDFã‚’è§£æä¸­...');

      try {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
        const totalPages = pdf.numPages;

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆè­¦å‘Šã®ã¿ï¼‰
        if (totalPages > 100) {
          console.warn('Large PDF detected:', totalPages, 'pages');
        }

        const zip = new JSZip();
        const folder = zip.folder('slides');

        for (let i = 1; i <= totalPages; i++) {
          // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒã‚§ãƒƒã‚¯
          if (state.cancelRequested) {
            reset();
            showToast('å‡¦ç†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ', 'info');
            return;
          }

          updateProgress(i, totalPages, `ã‚¹ãƒ©ã‚¤ãƒ‰ ${i}/${totalPages} ã‚’å‡¦ç†ä¸­...`);

          const page = await pdf.getPage(i);
          const scale = 2.0;
          const viewport = page.getViewport({ scale });

          const canvas = document.createElement('canvas');
          const context = canvas.getContext('2d');
          canvas.width = viewport.width;
          canvas.height = viewport.height;

          await page.render({ canvasContext: context, viewport }).promise;

          const dataUrl = canvas.toDataURL('image/png');
          const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));

          state.images.push({
            id: i,
            dataUrl,
            blob,
            width: viewport.width,
            height: viewport.height,
            name: `slide_${String(i).padStart(2, '0')}.png`
          });

          folder.file(`slide_${String(i).padStart(2, '0')}.png`, blob);

          // ãƒ¡ãƒ¢ãƒªè§£æ”¾
          canvas.width = 0;
          canvas.height = 0;

          // UIãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–æ€§ã®ãŸã‚ã®é…å»¶
          await new Promise(r => setTimeout(r, 30));
        }

        // æœ€çµ‚ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒã‚§ãƒƒã‚¯
        if (state.cancelRequested) {
          reset();
          showToast('å‡¦ç†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ', 'info');
          return;
        }

        updateProgress(totalPages, totalPages, 'ZIPã‚’ä½œæˆä¸­...');
        state.zipBlob = await zip.generateAsync({ type: 'blob' });

        showEditor();
        showToast(`${totalPages}æšã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’å¤‰æ›ã—ã¾ã—ãŸ`, 'success');
      } catch (err) {
        console.error('Processing error:', err);
        
        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è©³ç´°åŒ–
        let errorMsg = 'PDFã®å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
        if (err.name === 'PasswordException') {
          errorMsg = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ä¿è­·ã•ã‚ŒãŸPDFã¯å‡¦ç†ã§ãã¾ã›ã‚“ã€‚';
        } else if (err.name === 'InvalidPDFException') {
          errorMsg = 'ç„¡åŠ¹ãªPDFãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
        } else if (err.message && err.message.includes('memory')) {
          errorMsg = 'ãƒ¡ãƒ¢ãƒªä¸è¶³ã§ã™ã€‚ã‚ˆã‚Šå°ã•ã„PDFã§è©¦ã—ã¦ãã ã•ã„ã€‚';
        }
        
        showError(errorMsg);
      }
    }

    // ============================================
    // UI State Functions
    // ============================================
    function showProcessing() {
      elements.uploadArea.classList.add('hidden');
      elements.processingArea.classList.remove('hidden');
      elements.processingArea.style.display = 'flex';
      elements.editorArea.classList.add('hidden');
      elements.errorArea.classList.add('hidden');
      elements.headerContent.classList.add('hidden');
    }

    function showEditor() {
      elements.uploadArea.classList.add('hidden');
      elements.processingArea.classList.add('hidden');
      elements.processingArea.style.display = 'none';
      elements.editorArea.classList.remove('hidden');
      elements.errorArea.classList.add('hidden');
      elements.headerContent.classList.add('hidden');

      elements.fileName.textContent = state.file.name;
      elements.slideCount.textContent = `${state.images.length} ã‚¹ãƒ©ã‚¤ãƒ‰`;

      renderSlideGrid();
    }

    function showError(message) {
      elements.uploadArea.classList.add('hidden');
      elements.processingArea.classList.add('hidden');
      elements.processingArea.style.display = 'none';
      elements.editorArea.classList.add('hidden');
      elements.errorArea.classList.remove('hidden');
      elements.headerContent.classList.remove('hidden');
      elements.errorMessage.textContent = message;
    }

    function reset() {
      state.file = null;
      state.images = [];
      state.zipBlob = null;
      state.cancelRequested = false;
      elements.fileInput.value = '';

      elements.uploadArea.classList.remove('hidden');
      elements.processingArea.classList.add('hidden');
      elements.processingArea.style.display = 'none';
      elements.editorArea.classList.add('hidden');
      elements.errorArea.classList.add('hidden');
      elements.headerContent.classList.remove('hidden');
      elements.slideGrid.innerHTML = '';
    }

    function updateProgress(current, total, message) {
      const percent = total > 0 ? Math.round((current / total) * 100) : 0;
      const circumference = 289.02;
      const dashArray = `${(circumference * percent) / 100} ${circumference}`;

      elements.progressCircle.setAttribute('stroke-dasharray', dashArray);
      elements.progressPercent.textContent = `${percent}%`;
      elements.progressMessage.textContent = message;
    }

    function renderSlideGrid() {
      elements.slideGrid.innerHTML = '';

      state.images.forEach((img, idx) => {
        const slideEl = document.createElement('div');
        slideEl.className = 'group relative bg-slate-800/50 rounded-lg overflow-hidden cursor-pointer hover:ring-2 hover:ring-cyan-500/50 transition-all touch-feedback';
        slideEl.setAttribute('role', 'listitem');
        slideEl.innerHTML = `
          <img src="${img.dataUrl}" alt="ã‚¹ãƒ©ã‚¤ãƒ‰ ${idx + 1}" class="w-full h-auto" loading="lazy">
          <div class="absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-all flex items-center justify-center opacity-0 group-hover:opacity-100">
            <i data-lucide="maximize-2" class="w-6 h-6 text-white" aria-hidden="true"></i>
          </div>
          <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2">
            <span class="text-xs text-white font-medium">${idx + 1}</span>
          </div>
        `;

        slideEl.addEventListener('click', () => openSlideModal(idx));
        elements.slideGrid.appendChild(slideEl);
      });

      lucide.createIcons();
    }

    // ============================================
    // Modal Functions
    // ============================================
    function openSlideModal(idx) {
      state.currentModalSlide = idx;
      updateModalContent();
      elements.slideModal.classList.remove('hidden');
      elements.slideModal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      elements.slideModal.classList.add('hidden');
      elements.slideModal.style.display = 'none';
      document.body.style.overflow = '';
    }

    function navigateSlide(direction) {
      const newIndex = state.currentModalSlide + direction;
      if (newIndex >= 0 && newIndex < state.images.length) {
        state.currentModalSlide = newIndex;
        updateModalContent();
      }
    }

    function updateModalContent() {
      const img = state.images[state.currentModalSlide];
      elements.modalImage.src = img.dataUrl;
      elements.modalCaption.textContent = `ã‚¹ãƒ©ã‚¤ãƒ‰ ${state.currentModalSlide + 1} / ${state.images.length}`;
      
      // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®è¡¨ç¤º/éè¡¨ç¤º
      elements.prevSlide.style.display = state.currentModalSlide > 0 ? 'flex' : 'none';
      elements.nextSlide.style.display = state.currentModalSlide < state.images.length - 1 ? 'flex' : 'none';
    }

    // ============================================
    // Toast Notification
    // ============================================
    function showToast(message, type = 'success') {
      elements.toastMessage.textContent = message;
      
      // ã‚¢ã‚¤ã‚³ãƒ³æ›´æ–°
      const iconName = type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info';
      const iconColor = type === 'success' ? 'text-green-400' : type === 'error' ? 'text-red-400' : 'text-blue-400';
      elements.toastIcon.setAttribute('data-lucide', iconName);
      elements.toastIcon.className = `w-5 h-5 ${iconColor}`;
      lucide.createIcons();
      
      elements.toast.classList.remove('hidden');
      
      setTimeout(() => {
        elements.toast.classList.add('hidden');
      }, 3000);
    }

    // ============================================
    // Download Functions
    // ============================================
    function downloadFile(blob, filename) {
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    function setExportButtonsDisabled(disabled) {
      state.isExporting = disabled;
      elements.downloadZipBtn.disabled = disabled;
      elements.downloadPptxBtn.disabled = disabled;
      elements.downloadGifBtn.disabled = disabled;
      elements.downloadLongBtn.disabled = disabled;
    }

    function downloadZip() {
      if (state.zipBlob && state.file) {
        const filename = state.file.name.replace('.pdf', '') + '_slides.zip';
        downloadFile(state.zipBlob, filename);
        showToast('ZIPã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
      }
    }

    async function downloadPptx() {
      if (!state.images.length || state.isExporting) return;

      try {
        setExportButtonsDisabled(true);
        showToast('PPTXä½œæˆä¸­...', 'info');

        const pptx = new PptxGenJS();
        pptx.defineLayout({ name: 'CUSTOM', width: 10, height: 5.625 });
        pptx.layout = 'CUSTOM';

        for (const img of state.images) {
          const slide = pptx.addSlide();
          slide.addImage({
            data: img.dataUrl,
            x: 0,
            y: 0,
            w: '100%',
            h: '100%'
          });
        }

        const filename = state.file.name.replace('.pdf', '') + '.pptx';
        await pptx.writeFile({ fileName: filename });
        showToast('PPTXã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
      } catch (err) {
        console.error('PPTX export error:', err);
        showToast('PPTXä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      } finally {
        setExportButtonsDisabled(false);
      }
    }

    async function downloadGif() {
      if (!state.images.length || state.isExporting) return;

      try {
        setExportButtonsDisabled(true);
        showToast('GIFä½œæˆä¸­...ï¼ˆæ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼‰', 'info');

        // Load gif.js dynamically if not loaded
        if (!window.GIF) {
          await new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js';
            script.onload = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
          });
        }

        const gif = new GIF({
          workers: 2,
          quality: 10,
          workerScript: 'https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js'
        });

        for (const img of state.images) {
          const image = new Image();
          image.src = img.dataUrl;
          await new Promise(resolve => { image.onload = resolve; });
          gif.addFrame(image, { delay: 1000 });
        }

        gif.on('finished', (blob) => {
          const filename = state.file.name.replace('.pdf', '') + '.gif';
          downloadFile(blob, filename);
          showToast('GIFã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
          setExportButtonsDisabled(false);
        });

        gif.render();
      } catch (err) {
        console.error('GIF export error:', err);
        showToast('GIFä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        setExportButtonsDisabled(false);
      }
    }

    async function downloadLongImage() {
      if (!state.images.length || state.isExporting) return;

      try {
        setExportButtonsDisabled(true);
        showToast('é•·ç”»åƒä½œæˆä¸­...', 'info');

        const totalHeight = state.images.reduce((sum, img) => sum + img.height, 0);
        const maxWidth = Math.max(...state.images.map(img => img.width));

        // ã‚µã‚¤ã‚ºåˆ¶é™ãƒã‚§ãƒƒã‚¯
        if (totalHeight > 32000 || maxWidth > 32000) {
          showToast('ç”»åƒã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™', 'error');
          setExportButtonsDisabled(false);
          return;
        }

        const canvas = document.createElement('canvas');
        canvas.width = maxWidth;
        canvas.height = totalHeight;
        const ctx = canvas.getContext('2d');

        let y = 0;
        for (const img of state.images) {
          const image = new Image();
          image.src = img.dataUrl;
          await new Promise(resolve => { image.onload = resolve; });
          ctx.drawImage(image, 0, y, img.width, img.height);
          y += img.height;
        }

        canvas.toBlob((blob) => {
          const filename = state.file.name.replace('.pdf', '') + '_long.png';
          downloadFile(blob, filename);
          showToast('é•·ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
          
          // ãƒ¡ãƒ¢ãƒªè§£æ”¾
          canvas.width = 0;
          canvas.height = 0;
          setExportButtonsDisabled(false);
        }, 'image/png');
      } catch (err) {
        console.error('Long image export error:', err);
        showToast('é•·ç”»åƒä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        setExportButtonsDisabled(false);
      }
    }
  </script>

</body>
</html>
